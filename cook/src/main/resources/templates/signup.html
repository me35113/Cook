<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/logintop.css}">
    <style>
        /* 중복확인 메시지 박스 스타일 */
        #idCheckResult {
            padding: 8px;
            min-height: 24px;
            width: 300px;
            border-radius: 4px;
            font-weight: bold;
            box-sizing: border-box;
        }
        #idCheckResult.success {
            color: green;
            background-color: #e0f8e0;
            border: 1px solid green;
        }
        #idCheckResult.error {
            color: red;
            background-color: #f8e0e0;
            border: 1px solid red;
        }
    </style>
</head>
<body>
<div class="top-bar">
    <div class="logo">
        <img th:src="@{/images/logo.jpg}" alt="요리조리 로고" width="300">
    </div>
</div>

<form th:action="@{/signup}" method="post" th:object="${signupRequestDto}">
     <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <table border="1" cellpadding="5" cellspacing="0" style="width: 500px; margin: 0 auto;">
        <tr>
            <th>아이디</th>
            <td>
                <input type="text" th:field="*{userId}" placeholder="아이디 입력" required autocomplete="username" />
                <button type="button" class="check-btn" onclick="checkUserId()">중복확인</button>
                <div id="idCheckResult"></div>
            </td>
        </tr>
        <tr>
            <th>비밀번호</th>
            <td><input type="password" th:field="*{pwd}" placeholder="비밀번호 입력" required autocomplete="new-password" /></td>
        </tr>
        <tr>
            <th>이름</th>
            <td><input type="text" th:field="*{name}" placeholder="이름 입력" required /></td>
        </tr>
        <tr>
            <th>이메일</th>
            <td><input type="email" th:field="*{email}" placeholder="이메일 입력" required /></td>
        </tr>
        <tr>
            <th>프로필 이미지 URL</th>
            <td><input type="text" th:field="*{profile}" placeholder="프로필 입력" /></td>
        </tr>
        <tr>
            <th>성별</th>
            <td>
                <select th:field="*{gender}">
                    <option value="">선택</option>
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>우편번호</th>
            <td><input type="text" th:field="*{zipcode}" placeholder="우편번호 입력" /></td>
        </tr>
        <tr>
            <th>주소</th>
            <td><input type="text" th:field="*{address}" placeholder="주소 입력" /></td>
        </tr>
        <tr>
            <th>직업</th>
            <td>
                <select th:field="*{job}">
                    <option value="">선택</option>
                    <option value="학생">학생</option>
                    <option value="공무원">공무원</option>
                    <option value="개발자">개발자</option>
                    <option value="변호사">변호사</option>
                    <option value="기타">기타</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>자기소개</th>
            <td><textarea th:field="*{intro}" placeholder="자기소개 입력" rows="3" cols="30"></textarea></td>
        </tr>
        <tr>
            <th>알레르기</th>
            <td><input type="text" th:field="*{allergy}" /></td>
        </tr>
        <tr>
            <td colspan="2" style="text-align:center;">
                <button type="submit">회원가입</button>
            </td>
        </tr>
    </table>
</form>

<!-- 아이디 중복확인 스크립트 -->
<script>
function checkUserId() {
    const userId = document.querySelector('[name="userId"]').value.trim();
    const resultDiv = document.getElementById("idCheckResult");

    resultDiv.className = "";
    resultDiv.textContent = "";

    if (!userId) {
        resultDiv.textContent = "아이디를 입력하세요.";
        resultDiv.classList.add("error");
        return;
    }

    fetch(`/checkUserId?userId=` + encodeURIComponent(userId))
        .then(res => res.text())
        .then(data => {
            if (data === "duplicate") {
                resultDiv.textContent = "이미 사용 중인 아이디입니다.";
                resultDiv.classList.add("error");
            } else {
                resultDiv.textContent = "사용 가능한 아이디입니다.";
                resultDiv.classList.add("success");
            }
        })
        .catch(err => {
            resultDiv.textContent = "오류 발생";
            resultDiv.classList.add("error");
            console.error(err);
        });
}
</script>
</body>
</html>
